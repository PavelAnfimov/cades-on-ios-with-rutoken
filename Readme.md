# Пример формирования подписи в формате Cades X Long Type 1 на iOs устройствах с использованием Рутокен ЭЦП Bluetooth и Рутокен ЭЦП 3.0 NFC.

## Сборка
1.Для сборки проекта загрузите в корень директории [фреймфорк CPROCSP.framework](https://www.cryptopro.ru/products/csp/downloads). Я использовал [КриптоПро CSP 5.0.11998 (K) RC6 (https://www.cryptopro.ru/sites/default/files/private/csp/50/11998/ios-uni.tgz).
2. Сконфигурируйте проект согласно файлам ReadMe.txt и Readers.txt (проект из репозитория почти полностью сконфигурирован для версии КриптоПро CSP 5.0.11998 (K) RC6).
3. В процессе настройки вам потребуется установить RtPcsc.framework. Его можно взять из [Rutoken SDK](https://www.rutoken.ru/developers/sdk/) в директории **sdk/mobile/ios/pcsc/lib**. После подключения фреймворка перейдите во вкладку **Project settings->Targets->General->Frameworks, Libraries and Embedded content** и сделайте фрейворк RtPcsc.framework встраеваемым (Embed & Sign).
4. Установите [фреймворк CPROPKI.framework](https://www.cryptopro.ru/products/cades/downloads) в корень директории и добавьте его в свой проект.
5. Запустите сборку.

## Работа с приложением
### Импорт корневых сертификатов
1. Запустите приложение CreateFile.
2. Перейдите в панель КриптоПро нажав на внопку **"Launch Pane"**. 
3. Импортируйте сертификат УЦ выбрав вкладку **"Скачать и установить корневой сертификат"**. В поле укажите URL ссылку на файл с сертификатом УЦ.

### Регистрация контейнеров с Рутокен ЭЦП Bluetooth
1. Создайте криптоконтейнер на токене. Это можно сделать через [Тестовый УЦ КриптоПРО](https://www.cryptopro.ru/certsrv/).
2. Подключите Рутокен ЭЦП Bluetooth к iOs устройству.
3. Запустите приложение CreateFile и нажмите на кнопку **"Check readers"**. Убедитесь, что Рутокен обнаружился приложением.
4. Запустите панель КриптоПро нажав на внопку **"Launch Pane"**. Внутри панели выберете опцию **Установить сертификаты из контейнеров**. После этого шага контейнеры с Рутокен ЭЦП Bluetooth будут запомнены.

### Регистрация контейнеров с Рутокен ЭЦП 3.0 NFC
Логика приложения не тебует добавление в хранилище контейнеров Рутокен ЭЦП 3.0 NFC для работы с ними.

### СОздание и проверка подписи
Убедитесь, что при создании подписи у вас имеется подключение к интернету т.к. он нужен для обращению к TSP серверу. Для формирования подписи нажмите на кнопку **"Create file"**, а для проверки подписи -- **"Read file"**.

Для поиска ошибок используйте отладчик
