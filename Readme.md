# Пример формирования подписи в формате Cades X Long Type 1 на iOs устройствах с использованием Rutoken BT.

## Сборка
1.Для сборки проекта загрузите в корень директории [фреймфорк CPROCSP.framework](https://www.cryptopro.ru/products/csp/downloads). Я использовал для сборки [фреймворк КриптоПро CSP 5.0.11998 (K) RC6](https://www.cryptopro.ru/sites/default/files/private/csp/50/11998/ios-uni.tgz).
2. Сконфигурируйте фреймворк согласно файлам ReadMe.txt и Readers.txt в нем (проект из репозитория почти полностью сконфигурирован для версии КриптоПро CSP 5.0.11998 (K) RC6).
3. В процессе настройки вам потребуется установить RtPcsc.framework. Его можно взять из [Rutoken SDK](https://www.rutoken.ru/developers/sdk/) в директории **sdk/mobile/ios/pcsc/lib**. При подключении фреймворка перейдите во вкладку **Project settings->Targets->General->Frameworks, Libraries and Embedded content** и сделайте фрейворк RtPcsc.framework встраеваемым (Embed & Sign).
4. Установите [фреймворк CPROPKI.framework](https://www.cryptopro.ru/products/cades/downloads) в корень директории и добавьте его в свой проект.
6. Запустите сборку

## Работа с приложением
### Регистрация ключей с токена
1. Создайте криптоконтейнер на токене. Я использовал для этого [Тестовый УЦ КриптоПРО](https://www.cryptopro.ru/certsrv/)
2. Во время воздания криптоконтейнера вам будет предложено установить сертификат УЦ. Запомните URL ссылку на него
3. ПОдключите Rutoken BT к iOs устройству. Запустите приложение CreateFile и нажмите на кнопку **"Check readers"**. Убедитесь, что Rutoken обнаружился приложением
4. Запустите панель КриптоПРО нажав на внопку **"Launch Pane"**. Внутри панели выберете опцию **Установить сертификаты из контейнеров**. После этого шага контейнер с Рутокена будет запомнен.
5. После импорта сертификата пользователя импортируйте сертификат УЦ с помощью вкладки **"Скачать и установить корневой сертификат"**. В поле укажите запомненный URL с ссылкой на файл сертификата УЦ.

### СОздание и проверка подписи
Убедитесь, что при создании подписи у вас имеется подключение к интернету т.к. он нужен для обращению к TSP серверу. Для формирования подписи нажмите на кнопку **"Create file"**, а для проверки подписи -- **"Read file"**.

Для поиска ошибок используйте отладчик
